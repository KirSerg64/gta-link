# GTA: Global Tracklet Association for Multi-Object Tracking in Sports

## Introduction

This project introduces a universal, model-agnostic method designed to refine and enhance tracklet association for single-camera Multi-Object Tracking ([MOT](https://motchallenge.net/)). It is particularly suited for datasets such as [SportsMOT](https://github.com/MCG-NJU/SportsMOT) or [SoccerNet](https://github.com/SoccerNet/sn-tracking) but is also applicable to any MOT datasets. The approach is developed as an offline post-processing tool.
<!-- TODO: add results on datasets -->

## Methodology

Our method is model-agnostic, meaning it operates independently of the tracking models used to generate initial data. It only requires the tracking results from these models in text file MOT format and performs tracklet refinement through two main components: the tracklet splitter and the tracklet connector.

### Tracklet Splitter
<!-- TODO: add image to showcase a tracklet containing multiple identity -->
<!-- TODO: add clustering feature visualization -->

The tracklet splitter addresses the issue of impure tracklets that contain multiple identities. It utilizes unsupervised density-based spatial clustering, [DBSCAN](https://cdn.aaai.org/KDD/1996/KDD96-037.pdf), to cluster the instances within a tracklet based on their deep feature embeddings and to detect if there is an ID switch.

### Tracklet Connector

After the splitter processes the tracklets, the connector component iteratively merges tracklet pairs based on their averaged cosine distance between all tracklet instances' deep feature embeddings.

## Application

This refinement tool helps enhance tracking results from any tracker for an MOT task from any dataset. The tracklets are generated by the reid model, [OSNet](https://github.com/KaiyangZhou/deep-person-reid), which is trained on the SportsMOT dataset. You can also train and load your own reid model for tracklet generation. While the splitting and connecting components are train-free, there are parameters to tune for the clustering algorithms of both components.

## Installation

1. Clone the repository
2. Create a Python environment with version 3.8
    ```bash
    conda create -n gta_env python=3.8
    ```
3. Activate the environment

    ```bash
    conda activate gta_env
    ```
4. Install the required packages from requirements.txt

    ```bash
    pip install -r requirements.txt
    ```

5. Install PyTorch (project tested on PyTorch 2.3.0 and CUDA 11.8, modify the command to match your CUDA version)
    ```bash
    pip install torch torchvision torchaudio
    ```

6. Install the torchreid model based on OSNet
    - Option 1:
    Open the reid folder and install torchreid (project tested on torchreid 1.4.0)
        ```bash
        cd reid
        python setup.py develop
        ```
    - Option 2:
    In project folder, creat folder 'reid', then clone torchreid repository to local machine for the newest version of torchreid
        ```bash
        cd track-link
        mkdir reid
        git clone https://github.com/KaiyangZhou/deep-person-reid.git
        ```

Here is the refined instructions section with the correct syntax for running the scripts:

## Instructions for Running
NOTE:
Make sure to replace placeholders (e.g., `{}`) with actual values when running the commands.

1. Generate tracklets with your own tracking results:
    ```bash
    cd tools
    python generate_tracklets.py --model_path {reid model weight}
                                 --data_path {dataset directory}
                                 --pred_dir {tracking results direcotry}
                                 --tracker {tracker name}
    ```
    - `--model_path`: Specify the path to reid model's checkpoint file (default is `../reid_checkpoints/sports_model.pth.tar-60`)
    - `--data_path`: Specify directory of dataset's split data (e.g. `SoccerNet/tracking-2023/test`).
    - `--pred_dir`: Specify directory of tracking results txt files.
    - `--tracker`: Indicate tracker's name for file saving.

2. Refine tracklets:
    ```bash
    python refine_tracklets.py --dataset {dataset name}
                     --tracker {tracker name}
                     --track_src {source directory of tracklet pkl files}
                     --use_split
                     --min_len 100
                     --eps 0.6
                     --min_samples 10
                     --max_k 3
                     --use_connect
                     --spatial_factor 1.0
                     --merge_dist_thres 0.4
    ```
    - `--dataset`: Specify the dataset name (e.g., SportsMOT, SoccerNet) for file saving.
    - `--tracker`: Specify the tracker name for file saving.
    - `--track_src`: Path to the directory containing the tracklet `.pkl` files.
    - `--use_split`: Include this flag to use the split component.
    - `--min_len`: Minimum length for a tracklet required for splitting (default is 100).
    - `--eps`: Maximum distance between two samples for DBSCAN clustering (default is 0.6).
    - `--min_samples`: Minimum number of samples in a neighborhood for a point to be considered a core point (default is 10).
    - `--max_k`: Maximum number of clusters/subtracklets to be output by the splitting component (default is 3).
    - `--use_connect`: Include this flag to use the connecting component.
    - `--spatial_factor`: Factor to adjust spatial constraints (default is 1.0).
    - `--merge_dist_thres`: Minimum cosine distance between two tracklets for merging (default is 0.4).